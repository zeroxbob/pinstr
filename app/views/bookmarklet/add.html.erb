<div id="form-container" data-controller="bookmarklet-add">
  <h1>Save Bookmark to Pinstr</h1>

  <div id="nostr-status" class="nostr-status" data-bookmarklet-add-target="status">
    Checking for Nostr extension...
  </div>

  <div id="form-error" style="display: none;" class="alert" data-bookmarklet-add-target="formError"></div>

  <%= form_with(model: @bookmark, url: create_from_bookmarklet_path, id: "bookmark-form", data: { "bookmarklet-add-target": "form", action: "submit->bookmarklet-add#handleSubmit" }) do |form| %>
    <% if @bookmark.errors.any? %>
      <div class="alert">
        <h2><%= pluralize(@bookmark.errors.count, "error") %> prohibited this bookmark from being saved:</h2>
        <ul>
          <% @bookmark.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-group">
      <%= form.label :title %>
      <%= form.text_field :title, required: true, id: "bookmark-title", data: { "bookmarklet-add-target": "title" } %>
    </div>

    <div class="form-group">
      <%= form.label :url %>
      <%= form.text_field :url, required: true, id: "bookmark-url", data: { "bookmarklet-add-target": "url" } %>
    </div>

    <div class="form-group">
      <%= form.label :description %>
      <%= form.text_area :description, id: "bookmark-description", data: { "bookmarklet-add-target": "description" } %>
    </div>

    <% if @in_popup %>
      <%= hidden_field_tag :popup, "true" %>
    <% end %>

    <div class="actions">
      <button type="button" class="btn btn-secondary" data-action="click->bookmarklet-add#cancelBookmark">Cancel</button>
      <%= form.submit "Save Bookmark", class: "btn btn-primary", id: "submit-button", data: { "bookmarklet-add-target": "submitButton" } %>
    </div>
  <% end %>
  
  <div class="nostr-help mt-3">
    <p><small>
      <strong>Note:</strong> If you have a Nostr extension installed (like nos2x or Alby), you'll be prompted to sign this bookmark.
      <a href="<%= debug_bookmarklet_path %>" target="_blank">Nostr extension not working?</a>
    </small></p>
  </div>
</div>

<style>
  #form-error {
    background-color: #f8d7da;
    color: #721c24;
    padding: 0.75rem;
    border-radius: 4px;
    margin-bottom: 1rem;
    display: none;
  }
  
  .nostr-status {
    background-color: #f8f9fa;
    padding: 8px 12px;
    border-radius: 4px;
    margin-bottom: 16px;
    font-size: 14px;
    color: #6c757d;
    border-left: 4px solid #adb5bd;
  }
  
  .nostr-status-connected {
    background-color: #d1e7dd;
    border-left: 4px solid #198754;
    color: #0f5132;
  }
  
  .nostr-status-disconnected {
    background-color: #fff3cd;
    border-left: 4px solid #ffc107;
    color: #664d03;
  }
  
  .nostr-status-error {
    background-color: #f8d7da;
    border-left: 4px solid #dc3545;
    color: #842029;
  }
  
  .success-message {
    text-align: center;
    padding: 2rem 0;
  }
  
  .success-message h2 {
    color: #198754;
    margin-bottom: 1rem;
  }
  
  .success-nostr-status {
    background-color: #f8f9fa;
    padding: 12px;
    border-radius: 4px;
    margin: 16px auto;
    max-width: 80%;
    font-size: 14px;
    border-left: 4px solid #adb5bd;
  }
  
  .success-nostr-status.success {
    background-color: #d1e7dd;
    border-left: 4px solid #198754;
    color: #0f5132;
  }
  
  .success-nostr-status.warning {
    background-color: #fff3cd;
    border-left: 4px solid #ffc107;
    color: #664d03;
  }
  
  .auto-close-notice {
    margin-top: 1rem;
    color: #6c757d;
  }
  
  .buttons {
    margin-top: 1.5rem;
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
  
  .nostr-help {
    text-align: center;
    color: #6c757d;
    font-size: 0.9rem;
  }
  
  .mt-3 {
    margin-top: 1rem;
  }
  
  #countdown {
    font-weight: bold;
    color: #0066cc;
  }
</style>
